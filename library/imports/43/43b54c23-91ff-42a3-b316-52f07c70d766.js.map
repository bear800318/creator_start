{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Game.js"],"names":["cc","Class","extends","Component","properties","starPrefab","default","type","Prefab","heartPrefab","addScorePrefab","maxStarDuration","minStarDuration","maxHeart","ground","Node","player","scoreDisplay","Label","scoreAudio","AudioClip","timeDisplay","progressBarDisplay","ProgressBar","onLoad","groundY","y","height","timer","starDuration","heartAry","heart","creatNewStar","updateHeartCount","window","score","active","stasus","newPosition","getNewStarPosition","newStar","instantiate","node","addChild","setPosition","getComponent","game","Math","random","x","length","i","newHeart","v2","width","color","setProgressRate","time","progress","playScoreAnime","startX","startY","newScore","randX","randY","jumpHeight","maxX","update","dt","gameOver","enabled","string","ceil","gainScore","audioEngine","playEffect","stopAllActions","director","loadScene"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\n  extends: cc.Component,\n\n  properties: {\n    // 这个属性引用了星星预制资源\n    starPrefab: {\n      default: null,\n      type: cc.Prefab\n    },\n    heartPrefab: {\n      default: null,\n      type: cc.Prefab\n    },\n    //\n    addScorePrefab: {\n      default: null,\n      type: cc.Prefab\n    },\n\n    // 星星产生后消失时间的随机范围\n    maxStarDuration: 0,\n    minStarDuration: 0,\n    maxHeart: 0,\n    // 地面节点，用于确定星星生成的高度\n    ground: {\n      default: null,\n      type: cc.Node\n    },\n    // player 节点，用于获取主角弹跳的高度，和控制主角行动开关\n    player: {\n      default: null,\n      type: cc.Node\n    },\n\n    // score label 的引用\n    scoreDisplay: {\n      default: null,\n      type: cc.Label\n    },\n    // 得分音效资源\n    scoreAudio: {\n      default: null,\n      type: cc.AudioClip\n    },\n\n    timeDisplay: {\n      default: null,\n      type: cc.Label\n    },\n\n    progressBarDisplay: {\n      default: null,\n      type: cc.ProgressBar\n    }\n  },\n\n  onLoad: function() {\n    this.groundY = this.ground.y + this.ground.height / 2;\n    this.timer = 0;\n    this.starDuration = 0;\n    this.heartAry = [];\n    this.heart = this.maxHeart;\n    this.creatNewStar();\n    this.updateHeartCount();\n    window.score = 0;\n    this.player.active = true;\n    window.stasus = \"GO\";\n  },\n  /** 創建星星 */\n  creatNewStar: function() {\n    let newPosition = this.getNewStarPosition();\n    let newStar = cc.instantiate(this.starPrefab);\n    this.node.addChild(newStar);\n    newStar.setPosition(newPosition);\n    newStar.getComponent(\"Star\").game = this;\n    this.starDuration =\n      this.minStarDuration +\n      Math.random() * (this.maxStarDuration - this.minStarDuration);\n    this.timer = 0;\n    this.progressBarDisplay.node.x = newPosition.x;\n    this.progressBarDisplay.node.y = newPosition.y - 48;\n  },\n  /** 更新愛心數 */\n  updateHeartCount: function() {\n    if (this.heartAry.length == 0) {\n      for (let i = 0; i < this.maxHeart; i++) {\n        let newHeart = cc.instantiate(this.heartPrefab);\n        this.node.addChild(newHeart);\n        newHeart.setPosition(\n          cc.v2(\n            this.scoreDisplay.node.x + i * newHeart.width,\n            this.scoreDisplay.node.y - this.scoreDisplay.node.height - 5\n          )\n        );\n        this.heartAry[i] = newHeart;\n      }\n    } else {\n      for (let i = this.maxHeart - 1; i > this.heart - 1; i--) {\n        this.heartAry[i].color = cc.color(70, 70, 70, 255);\n      }\n    }\n  },\n\n  setProgressRate(time) {\n    this.progressBarDisplay.progress = 1 - time / this.starDuration;\n  },\n\n  /**\n   * 加分動畫\n   * @param {*} startX\n   * @param {*} startY\n   */\n  playScoreAnime: function(startX, startY) {\n    let newScore = cc.instantiate(this.addScorePrefab);\n    this.node.addChild(newScore);\n    newScore.setPosition(cc.v2(startX + 20, startY + 20));\n    newScore.getComponent(\"Score\").game = this;\n  },\n\n  getNewStarPosition: function() {\n    let randX = 0;\n    let randY =\n      this.groundY +\n      Math.random() * this.player.getComponent(\"Player\").jumpHeight +\n      50;\n    let maxX = this.node.width / 2;\n    randX = (Math.random() - 0.5) * 2 * maxX;\n    return cc.v2(randX, randY);\n  },\n\n  update: function(dt) {\n    if (window.stasus == \"GO\") {\n      if (this.timer > this.starDuration) {\n        this.heart--;\n        this.updateHeartCount();\n        if (this.heart == 0) {\n          this.gameOver();\n          this.enabled = false;\n          return;\n        } else {\n          this.timer = 0;\n        }\n      }\n      this.timer += dt;\n      this.timeDisplay.string = \"Time: \" + Math.ceil(this.timer);\n      this.setProgressRate(this.timer);\n    }\n  },\n\n  gainScore: function() {\n    window.score += 1;\n    // 更新 scoreDisplay Label 的文字\n    this.scoreDisplay.string = \"Score: \" + window.score;\n    // 播放得分音效\n    cc.audioEngine.playEffect(this.scoreAudio, false);\n  },\n\n  gameOver: function() {\n    window.stasus = \"GameOver\";\n    this.player.stopAllActions(); //停止 player 节点的跳跃动作\n    cc.director.loadScene(\"Start\");\n  }\n});\n"]}